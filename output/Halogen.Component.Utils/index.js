// Generated by purs version 0.11.5
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_AVar = require("../Control.Monad.Aff.AVar");
var Control_Monad_Aff_Bus = require("../Control.Monad.Aff.Bus");
var Control_Monad_Aff_Class = require("../Control.Monad.Aff.Class");
var Control_Monad_Aff_EventLoop = require("../Control.Monad.Aff.EventLoop");
var Data_Either = require("../Data.Either");
var Data_Function = require("../Data.Function");
var Data_Time_Duration = require("../Data.Time.Duration");
var Data_Unit = require("../Data.Unit");
var Halogen = require("../Halogen");
var Halogen_Query_EventSource = require("../Halogen.Query.EventSource");
var Halogen_Query_HalogenM = require("../Halogen.Query.HalogenM");
var Prelude = require("../Prelude");
var oneTimeEventSource = function (dictMonadAff) {
    return function (ms) {
        return function (action) {
            return function (cancelerVar) {
                var producer = Halogen_Query_EventSource.produceAff(dictMonadAff)(function (emit) {
                    return Control_Monad_Aff_Class.liftAff(Control_Monad_Aff_Class.monadAffAff)((function () {
                        var delayedEmitter = Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff.delay(ms))(function () {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(emit(Data_Either.Left.create(action(Halogen_Query_EventSource.Done.value))))(function () {
                                return emit(new Data_Either.Right(Data_Unit.unit));
                            });
                        });
                        return Control_Bind.bindFlipped(Control_Monad_Aff.bindAff)(Control_Monad_Aff_AVar.putVar(cancelerVar))(Control_Monad_Aff.forkAff(delayedEmitter));
                    })());
                });
                return Control_Applicative.pure(((dictMonadAff.MonadEff0()).Monad0()).Applicative0())({
                    producer: producer, 
                    done: Control_Applicative.pure(((dictMonadAff.MonadEff0()).Monad0()).Applicative0())(Data_Unit.unit)
                });
            };
        };
    };
};
var sendAfter = function (dictMonadAff) {
    return function (ms) {
        return function (action) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_Aff_Class.liftAff(Halogen_Query_HalogenM.monadAffHalogenM(dictMonadAff))(Control_Monad_Aff_AVar.makeVar))(function (v) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.subscribe(oneTimeEventSource(dictMonadAff)(ms)(action)(v)))(function () {
                    return Control_Monad_Aff_Class.liftAff(Halogen_Query_HalogenM.monadAffHalogenM(dictMonadAff))(Control_Monad_Aff_AVar.takeVar(v));
                });
            });
        };
    };
};
var affEventSource = function (dictMonadAff) {
    return function (k) {
        return function (source) {
            return Control_Bind.bind(((dictMonadAff.MonadEff0()).Monad0()).Bind1())(Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Monad_Aff_AVar.makeVar))(function (v) {
                var producer = Halogen_Query_EventSource.produceAff(dictMonadAff)(function (emit) {
                    return Control_Monad_Aff_Class.liftAff(Control_Monad_Aff_Class.monadAffAff)(Control_Bind.bind(Control_Monad_Aff.bindAff)(Control_Monad_Aff_EventLoop.forever(Control_Bind.bind(Control_Monad_Aff.bindAff)(source)(function (v1) {
                        return Control_Monad_Aff.forkAff(emit(new Data_Either.Left(k(v1))));
                    })))(function (v1) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Aff.bindAff)(Control_Monad_Aff_AVar.putVar(v)(v1.breaker))(function () {
                            return v1.run;
                        });
                    }));
                });
                var done = Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Bind.bindFlipped(Control_Monad_Aff.bindAff)(Control_Monad_Aff_EventLoop["break'"])(Control_Monad_Aff_AVar.takeVar(v)));
                return Control_Applicative.pure(((dictMonadAff.MonadEff0()).Monad0()).Applicative0())({
                    producer: producer, 
                    done: done
                });
            });
        };
    };
};
var busEventSource = function (dictMonadAff) {
    return function (k) {
        return function (bus) {
            return affEventSource(dictMonadAff)(k)(Control_Monad_Aff_Bus.read(bus));
        };
    };
};
module.exports = {
    affEventSource: affEventSource, 
    busEventSource: busEventSource, 
    oneTimeEventSource: oneTimeEventSource, 
    sendAfter: sendAfter
};
