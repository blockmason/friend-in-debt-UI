// Generated by purs version 0.11.5
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Category = require("../Control.Category");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_Bus = require("../Control.Monad.Aff.Bus");
var Control_Monad_Aff_Class = require("../Control.Monad.Aff.Class");
var Control_Monad_Eff_Class = require("../Control.Monad.Eff.Class");
var Control_Monad_Eff_Console = require("../Control.Monad.Eff.Console");
var Control_Monad_State_Class = require("../Control.Monad.State.Class");
var Control_Semigroupoid = require("../Control.Semigroupoid");
var DOM_HTML_Indexed_InputType = require("../DOM.HTML.Indexed.InputType");
var Data_Array = require("../Data.Array");
var Data_Either = require("../Data.Either");
var Data_Eq = require("../Data.Eq");
var Data_Function = require("../Data.Function");
var Data_Functor = require("../Data.Functor");
var Data_Int = require("../Data.Int");
var Data_List_Types = require("../Data.List.Types");
var Data_Map = require("../Data.Map");
var Data_Maybe = require("../Data.Maybe");
var Data_Number = require("../Data.Number");
var Data_Ord = require("../Data.Ord");
var Data_Ring = require("../Data.Ring");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Show = require("../Data.Show");
var Data_String = require("../Data.String");
var Data_Tuple = require("../Data.Tuple");
var Data_Unit = require("../Data.Unit");
var FriendInDebt_Prelude = require("../FriendInDebt.Prelude");
var Halogen = require("../Halogen");
var Halogen_Component = require("../Halogen.Component");
var Halogen_HTML = require("../Halogen.HTML");
var Halogen_HTML_Core = require("../Halogen.HTML.Core");
var Halogen_HTML_Elements = require("../Halogen.HTML.Elements");
var Halogen_HTML_Events = require("../Halogen.HTML.Events");
var Halogen_HTML_Properties = require("../Halogen.HTML.Properties");
var Halogen_Query_HalogenM = require("../Halogen.Query.HalogenM");
var Network_Eth_FriendInDebt = require("../Network.Eth.FriendInDebt");
var Types = require("../Types");
var Utils = require("../Utils");
var RefreshDebts = (function () {
    function RefreshDebts(value0) {
        this.value0 = value0;
    };
    RefreshDebts.create = function (value0) {
        return new RefreshDebts(value0);
    };
    return RefreshDebts;
})();
var HandleInput = (function () {
    function HandleInput(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    HandleInput.create = function (value0) {
        return function (value1) {
            return new HandleInput(value0, value1);
        };
    };
    return HandleInput;
})();
var CreateDebt = (function () {
    function CreateDebt(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    CreateDebt.create = function (value0) {
        return function (value1) {
            return new CreateDebt(value0, value1);
        };
    };
    return CreateDebt;
})();
var SendDebt = (function () {
    function SendDebt(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    SendDebt.create = function (value0) {
        return function (value1) {
            return new SendDebt(value0, value1);
        };
    };
    return SendDebt;
})();
var ConfirmPending = (function () {
    function ConfirmPending(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    ConfirmPending.create = function (value0) {
        return function (value1) {
            return new ConfirmPending(value0, value1);
        };
    };
    return ConfirmPending;
})();
var CancelPending = (function () {
    function CancelPending(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    CancelPending.create = function (value0) {
        return function (value1) {
            return new CancelPending(value0, value1);
        };
    };
    return CancelPending;
})();
var AddFriend = (function () {
    function AddFriend(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    AddFriend.create = function (value0) {
        return function (value1) {
            return new AddFriend(value0, value1);
        };
    };
    return AddFriend;
})();
var InputFriend = (function () {
    function InputFriend(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    InputFriend.create = function (value0) {
        return function (value1) {
            return new InputFriend(value0, value1);
        };
    };
    return InputFriend;
})();
var InputName = (function () {
    function InputName(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    InputName.create = function (value0) {
        return function (value1) {
            return new InputName(value0, value1);
        };
    };
    return InputName;
})();
var UpdateName = (function () {
    function UpdateName(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    UpdateName.create = function (value0) {
        return function (value1) {
            return new UpdateName(value0, value1);
        };
    };
    return UpdateName;
})();
var refreshButton = Halogen_HTML_Elements.button([ Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(RefreshDebts.create)), Halogen_HTML_Properties.class_("btn-info") ])([ Halogen_HTML_Core.text("Refresh") ]);
var numberFromString = function (s) {
    return Data_Maybe.fromMaybe(Data_Int.toNumber(0))(Data_Number.fromString(s));
};
var nonZero = function (fd) {
    return Data_Eq.notEq(Network_Eth_FriendInDebt.eqMoney)(Network_Eth_FriendInDebt.getDebt(fd))(Network_Eth_FriendInDebt.Money(Data_Int.toNumber(0)));
};
var nameChangeWidget = function (inputName) {
    return function (userName) {
        return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("nameChange") ])([ Halogen_HTML_Elements.input([ Halogen_HTML_Properties.type_(Halogen_HTML_Core.inputTypeIsProp)(DOM_HTML_Indexed_InputType.InputText.value), Halogen_HTML_Properties.value(inputName), Halogen_HTML_Events.onValueInput(Halogen_HTML_Events.input(function (val) {
            return InputName.create(val);
        })) ]), Halogen_HTML_Elements.button([ Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(UpdateName.create(inputName))), Halogen_HTML_Properties.class_("btn-info") ])([ Halogen_HTML_Core.text("Change My Name from " + (Data_Either.either(Network_Eth_FriendInDebt.getUa)(Control_Category.id(Control_Category.categoryFn))(userName) + (function () {
            var $52 = Data_String.length(inputName) > 0;
            if ($52) {
                return " to " + inputName;
            };
            return "";
        })())) ]) ]);
    };
};
var moneySpan = function (v) {
    var debtCompare = Network_Eth_FriendInDebt.posNegZero(v);
    var compRes = (function () {
        if (debtCompare instanceof Network_Eth_FriendInDebt.Positive) {
            return "amount-payable";
        };
        if (debtCompare instanceof Network_Eth_FriendInDebt.Negative) {
            return "amount-receivable";
        };
        if (debtCompare instanceof Network_Eth_FriendInDebt.Zero) {
            return "amount-nothing";
        };
        throw new Error("Failed pattern match at Debts line 249, column 17 - line 253, column 5: " + [ debtCompare.constructor.name ]);
    })();
    return Halogen_HTML_Elements.span([ Halogen_HTML_Properties.class_(Halogen_HTML_Core.ClassName(compRes)) ])([ Halogen_HTML_Core.text(Data_Show.show(Network_Eth_FriendInDebt.showMoney)(Network_Eth_FriendInDebt.absMoney(v.debt))) ]);
};
var moneyClass = function (fd) {
    var v = Network_Eth_FriendInDebt.posNegZero(fd);
    if (v instanceof Network_Eth_FriendInDebt.Positive) {
        return "oweMoney";
    };
    if (v instanceof Network_Eth_FriendInDebt.Negative) {
        return "owedMoney";
    };
    if (v instanceof Network_Eth_FriendInDebt.Zero) {
        return "zeroMoney";
    };
    throw new Error("Failed pattern match at Debts line 257, column 17 - line 262, column 1: " + [ v.constructor.name ]);
};
var reverseMoneyClass = function ($171) {
    return moneyClass(Network_Eth_FriendInDebt.flipDebt($171));
};
var mkDebt = function (friend) {
    return function (debtStr) {
        return Network_Eth_FriendInDebt.newDebt(friend)(numberFromString(debtStr));
    };
};
var handleFIDCallEff = function (dictBind) {
    return function (dictMonadEff) {
        return function (dictMonadAff) {
            return function (errorBus) {
                return function (blankVal) {
                    return function (fidAffCall) {
                        if (errorBus instanceof Data_Maybe.Nothing) {
                            return Control_Bind.discard(Control_Bind.discardUnit)(dictBind)(Control_Monad_Eff_Class.liftEff(dictMonadEff)(Control_Monad_Eff_Console.logShow(Data_Show.showString)("No bus initialized")))(function () {
                                return Control_Applicative.pure((dictMonadEff.Monad0()).Applicative0())(blankVal);
                            });
                        };
                        if (errorBus instanceof Data_Maybe.Just) {
                            return Control_Bind.bind(dictBind)(Control_Monad_Eff_Class.liftEff(dictMonadEff)(fidAffCall))(function (v) {
                                if (v instanceof Data_Either.Left) {
                                    return Control_Bind.bind(dictBind)(Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Monad_Aff_Bus.write(new Types.FIDError(v.value0))(errorBus.value0)))(function (v1) {
                                        return Control_Applicative.pure((dictMonadEff.Monad0()).Applicative0())(blankVal);
                                    });
                                };
                                if (v instanceof Data_Either.Right) {
                                    return Control_Applicative.pure((dictMonadEff.Monad0()).Applicative0())(v.value0);
                                };
                                throw new Error("Failed pattern match at Debts line 361, column 7 - line 364, column 27: " + [ v.constructor.name ]);
                            });
                        };
                        throw new Error("Failed pattern match at Debts line 355, column 3 - line 364, column 27: " + [ errorBus.constructor.name ]);
                    };
                };
            };
        };
    };
};
var handleFIDCallAff = function (dictBind) {
    return function (dictMonadEff) {
        return function (dictMonadAff) {
            return function (errorBus) {
                return function (blankVal) {
                    return function (fidAffCall) {
                        if (errorBus instanceof Data_Maybe.Nothing) {
                            return Control_Bind.discard(Control_Bind.discardUnit)(dictBind)(Control_Monad_Eff_Class.liftEff(dictMonadEff)(Control_Monad_Eff_Console.logShow(Data_Show.showString)("No bus initialized")))(function () {
                                return Control_Applicative.pure((dictMonadEff.Monad0()).Applicative0())(blankVal);
                            });
                        };
                        if (errorBus instanceof Data_Maybe.Just) {
                            return Control_Bind.bind(dictBind)(Control_Monad_Aff_Class.liftAff(dictMonadAff)(fidAffCall))(function (v) {
                                if (v instanceof Data_Either.Left) {
                                    return Control_Bind.bind(dictBind)(Control_Monad_Aff_Class.liftAff(dictMonadAff)(Control_Monad_Aff_Bus.write(new Types.FIDError(v.value0))(errorBus.value0)))(function (v1) {
                                        return Control_Applicative.pure((dictMonadEff.Monad0()).Applicative0())(blankVal);
                                    });
                                };
                                if (v instanceof Data_Either.Right) {
                                    return Control_Applicative.pure((dictMonadEff.Monad0()).Applicative0())(v.value0);
                                };
                                throw new Error("Failed pattern match at Debts line 349, column 7 - line 352, column 30: " + [ v.constructor.name ]);
                            });
                        };
                        throw new Error("Failed pattern match at Debts line 343, column 3 - line 352, column 30: " + [ errorBus.constructor.name ]);
                    };
                };
            };
        };
    };
};
var loadFriendsAndDebts = function (dictBind) {
    return function (dictMonadState) {
        return function (dictMonadEff) {
            return function (dictMonadAff) {
                return function (errorBus) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(dictBind)(Control_Monad_State_Class.modify(dictMonadState)(function (v) {
                        var $68 = {};
                        for (var $69 in v) {
                            if ({}.hasOwnProperty.call(v, $69)) {
                                $68[$69] = v[$69];
                            };
                        };
                        $68.loading = true;
                        return $68;
                    }))(function () {
                        return Control_Bind.bind(dictBind)(handleFIDCallAff(dictBind)(dictMonadEff)(dictMonadAff)(errorBus)([  ])(Network_Eth_FriendInDebt.currentUserFriends))(function (v) {
                            return Control_Bind.bind(dictBind)(handleFIDCallAff(dictBind)(dictMonadEff)(dictMonadAff)(errorBus)(new Data_Either.Right(""))(Network_Eth_FriendInDebt.getCurrentUserName))(function (v1) {
                                return Control_Bind.bind(dictBind)(handleFIDCallAff(dictBind)(dictMonadEff)(dictMonadAff)(errorBus)(Data_Map.empty)(Network_Eth_FriendInDebt.allNames(v)))(function (v2) {
                                    return Control_Bind.bind(dictBind)(handleFIDCallAff(dictBind)(dictMonadEff)(dictMonadAff)(errorBus)([  ])(Network_Eth_FriendInDebt.currentUserDebts(v)))(function (v3) {
                                        return Control_Bind.bind(dictBind)(handleFIDCallAff(dictBind)(dictMonadEff)(dictMonadAff)(errorBus)([  ])(Network_Eth_FriendInDebt.currentUserPending(v)))(function (v4) {
                                            return Control_Bind.bind(dictBind)(handleFIDCallAff(dictBind)(dictMonadEff)(dictMonadAff)(errorBus)([  ])(Network_Eth_FriendInDebt.currentUserSentPendings(v)))(function (v5) {
                                                return Control_Monad_State_Class.modify(dictMonadState)(function (v6) {
                                                    var $77 = {};
                                                    for (var $78 in v6) {
                                                        if ({}.hasOwnProperty.call(v6, $78)) {
                                                            $77[$78] = v6[$78];
                                                        };
                                                    };
                                                    $77.friends = v;
                                                    $77.debts = v3;
                                                    $77.pending = v4;
                                                    $77.loading = false;
                                                    $77.sentPending = v5;
                                                    $77.names = v2;
                                                    $77.userName = v1;
                                                    return $77;
                                                });
                                            });
                                        });
                                    });
                                });
                            });
                        });
                    });
                };
            };
        };
    };
};
var displayFriendLi = function (n) {
    return Halogen_HTML_Elements.li([ Halogen_HTML_Properties.class_("friend-row") ])([ Halogen_HTML_Core.text(n) ]);
};
var displayDebtChanges = function (nm) {
    return function (v) {
        return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("debt-changes") ])([ Halogen_HTML_Elements.span([ Halogen_HTML_Properties.class_("originalDebt") ])([ moneySpan(v.value0) ]), Halogen_HTML_Elements.span([ Halogen_HTML_Properties.class_("changedDebt") ])([ moneySpan(Network_Eth_FriendInDebt.addDebt(v.value0)(Network_Eth_FriendInDebt.getDebt(v.value1))) ]) ]) ];
    };
};
var displayDebt = function (nm) {
    return function (v) {
        var nameSpan = function (n) {
            return Halogen_HTML_Elements.span([ Halogen_HTML_Properties.class_("user-name user-id") ])([ Halogen_HTML_Core.text(n) ]);
        };
        var fName = function (friend) {
            return Data_Maybe.fromMaybe(Data_String.take(10)(Network_Eth_FriendInDebt.getUa(v.friend)))(Data_Map.lookup(Network_Eth_FriendInDebt.ordUserAddress)(friend)(nm));
        };
        var compRes = Network_Eth_FriendInDebt.posNegZero(v);
        if (compRes instanceof Network_Eth_FriendInDebt.Positive) {
            return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-amount") ])([ nameSpan(fName(v.friend) + " "), moneySpan(v) ]) ];
        };
        if (compRes instanceof Network_Eth_FriendInDebt.Negative) {
            return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-amount") ])([ nameSpan(fName(v.friend) + " "), moneySpan(v) ]) ];
        };
        if (compRes instanceof Network_Eth_FriendInDebt.Zero) {
            return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-amount") ])([ nameSpan(fName(v.friend) + " "), moneySpan(v) ]) ];
        };
        throw new Error("Failed pattern match at Debts line 232, column 6 - line 235, column 126: " + [ compRes.constructor.name ]);
    };
};
var displayFriendDebtLi = function (nm) {
    return function (fd) {
        return Halogen_HTML_Elements.li([ Halogen_HTML_Properties.class_(Halogen_HTML_Core.ClassName(moneyClass(fd))) ])(displayDebt(nm)(fd));
    };
};
var displayFriendDebtSpan = function (nm) {
    return function (v) {
        return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_(Halogen_HTML_Core.ClassName(moneyClass(v.value1) + " confirmation-body row")) ])(Data_Semigroup.append(Data_Semigroup.semigroupArray)(displayDebt(nm)(v.value1))(displayDebtChanges(nm)(new Data_Tuple.Tuple(v.value0, v.value1))));
    };
};
var displayAllDebt = function (nm) {
    return function (v) {
        var v1 = new Data_Tuple.Tuple(v.value0, v.value1);
        var nameSpan = function (n) {
            return Halogen_HTML_Elements.span([ Halogen_HTML_Properties.class_("user-name user-id col-sm-8") ])([ Halogen_HTML_Core.text(n) ]);
        };
        var fName = function (friend) {
            return Data_Maybe.fromMaybe(Data_String.take(10)(Network_Eth_FriendInDebt.getUa(v1.value0.friend)))(Data_Map.lookup(Network_Eth_FriendInDebt.ordUserAddress)(friend)(nm));
        };
        var combinedDebt = Network_Eth_FriendInDebt.addDebt(v.value0)(Network_Eth_FriendInDebt.getDebt(v.value1));
        var compRes = Network_Eth_FriendInDebt.posNegZero(combinedDebt);
        if (compRes instanceof Network_Eth_FriendInDebt.Positive) {
            return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-amount") ])([ nameSpan(fName(v1.value0.friend)), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("current-debt-amount") ])([ moneySpan(combinedDebt), moneySpan(v.value1) ]) ]) ];
        };
        if (compRes instanceof Network_Eth_FriendInDebt.Negative) {
            return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-amount") ])([ nameSpan(fName(v1.value0.friend)), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("current-debt-amount") ])([ moneySpan(combinedDebt), moneySpan(v.value1) ]) ]) ];
        };
        if (compRes instanceof Network_Eth_FriendInDebt.Zero) {
            return [ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-amount") ])([ nameSpan(fName(v1.value0.friend)) ]) ];
        };
        throw new Error("Failed pattern match at Debts line 219, column 6 - line 224, column 108: " + [ compRes.constructor.name ]);
    };
};
var displayAllDebtLi = function (nm) {
    return function (v) {
        return Halogen_HTML_Elements.li([ Halogen_HTML_Properties.class_(Halogen_HTML_Core.ClassName(moneyClass(v.value0))) ])(displayAllDebt(nm)(new Data_Tuple.Tuple(v.value0, v.value1)));
    };
};
var createDebt = function (nm) {
    return function (creating) {
        return function (friend) {
            var fd = Data_Maybe.fromMaybe(Network_Eth_FriendInDebt.friendDebtZero(friend))(Data_Map.lookup(Network_Eth_FriendInDebt.ordUserAddress)(friend)(creating));
            return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("createDebt") ])([ Halogen_HTML_Core.text("$"), Halogen_HTML_Elements.input([ Halogen_HTML_Properties.type_(Halogen_HTML_Core.inputTypeIsProp)(DOM_HTML_Indexed_InputType.InputNumber.value), Halogen_HTML_Properties.class_(Halogen_HTML_Core.ClassName(reverseMoneyClass(fd))), Halogen_HTML_Properties.value("0"), Halogen_HTML_Events.onValueInput(Halogen_HTML_Events.input(function (val) {
                return CreateDebt.create(mkDebt(friend)(val));
            })), Halogen_HTML_Properties.min(Data_Int.toNumber(-1000000 | 0)), Halogen_HTML_Properties.max(Data_Int.toNumber(1000000)) ]), Halogen_HTML_Elements.button([ Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(SendDebt.create(friend))), Halogen_HTML_Properties.class_("btn-info") ])(Data_Semigroup.append(Data_Semigroup.semigroupArray)([ Halogen_HTML_Core.text("Debt: ") ])(displayDebt(nm)(Network_Eth_FriendInDebt.flipDebt(fd)))) ]);
        };
    };
};
var confirmButton = function (fd) {
    return Halogen_HTML_Elements.button([ Halogen_HTML_Properties.class_("col-sm-6 btn-confirm"), Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(ConfirmPending.create(fd))) ])([ Halogen_HTML_Core.text("Confirm") ]);
};
var cancelButton = function (fd) {
    return Halogen_HTML_Elements.button([ Halogen_HTML_Properties.class_("col-sm-6 btn-cancel"), Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(CancelPending.create(fd))) ])([ Halogen_HTML_Core.text("Cancel") ]);
};
var displayPending = function (nm) {
    return function (v) {
        return Halogen_HTML_Elements.li([ Halogen_HTML_Properties.class_("confirmation-row flipInX") ])([ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirmation-header row") ])([ cancelButton(v.value1), confirmButton(v.value1) ]), displayFriendDebtSpan(nm)(new Data_Tuple.Tuple(v.value0, v.value1)) ]);
    };
};
var addFriendWidget = function (state) {
    var inputVal = Data_Either.either(Control_Category.id(Control_Category.categoryFn))(Network_Eth_FriendInDebt.getUa);
    return Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("addFriend") ])([ Halogen_HTML_Elements.input([ Halogen_HTML_Properties.type_(Halogen_HTML_Core.inputTypeIsProp)(DOM_HTML_Indexed_InputType.InputText.value), Halogen_HTML_Properties.value(inputVal(state.newFriend)), Halogen_HTML_Events.onValueInput(Halogen_HTML_Events.input(function (val) {
        return InputFriend.create(val);
    })) ]), Halogen_HTML_Elements.button([ Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(AddFriend.create(state.newFriend))), Halogen_HTML_Properties.class_("btn-info") ])([ Halogen_HTML_Core.text("Add Friend by Address") ]) ]);
};
var component = (function () {
    var render = function (state) {
        var pending = Data_Array.filter(function (v) {
            return nonZero(v.value1);
        })(Data_Array.zip(state.debts)(state.pending));
        var friendNames = Data_Array.fromFoldable(Data_List_Types.foldableList)(Data_Map.values(state.names));
        if (state.loading) {
            return Halogen_HTML_Elements.span_([ Halogen_HTML_Elements.h6_([ Halogen_HTML_Core.text("Loading debt info...") ]), Halogen_HTML_Elements.img([ Halogen_HTML_Properties.src("loading.gif"), Halogen_HTML_Properties.width(25) ]) ]);
        };
        return Halogen_HTML_Elements.div_([ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("confirm-debts-container") ])([ Halogen_HTML_Elements.ul_(Data_Functor.map(Data_Functor.functorArray)(displayPending(state.names))(pending)) ]), Halogen_HTML_Elements.h1_([ Halogen_HTML_Core.text("Current Debts") ]), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("current-debts-container") ])([ Halogen_HTML_Elements.ul_(Data_Functor.map(Data_Functor.functorArray)(displayAllDebtLi(state.names))(Data_Array.zip(state.debts)(state.sentPending))) ]), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("all-friends-container") ])([ Halogen_HTML_Elements.ul_(Data_Functor.map(Data_Functor.functorArray)(displayFriendLi)(friendNames)) ]), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("add-friend-name-change-container") ])([ Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("add-friend-container") ])([ addFriendWidget(state) ]), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("name-change-container") ])([ nameChangeWidget(state.inputName)(state.userName) ]) ]), Halogen_HTML_Elements.div([ Halogen_HTML_Properties.class_("create-debt-container") ])([ Halogen_HTML_Elements.h5_([ Halogen_HTML_Core.text("Create Debt") ]), Halogen_HTML_Elements.ul_(Data_Functor.map(Data_Functor.functorArray)(function (friend) {
            return Halogen_HTML_Elements.li_([ createDebt(state.names)(state.creating)(friend) ]);
        })(state.friends)) ]) ]);
    };
    var initialState = function (input) {
        return {
            friends: [  ], 
            debts: [  ], 
            pending: [  ], 
            sentPending: [  ], 
            creating: Data_Map.empty, 
            names: Data_Map.empty, 
            newFriend: new Data_Either.Left(""), 
            userName: new Data_Either.Right(""), 
            inputName: "", 
            loading: false, 
            errorBus: input
        };
    };
    var $$eval = function (v) {
        if (v instanceof HandleInput) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v1) {
                var $112 = {};
                for (var $113 in v1) {
                    if ({}.hasOwnProperty.call(v1, $113)) {
                        $112[$113] = v1[$113];
                    };
                };
                $112.errorBus = v.value0;
                return $112;
            }))(function () {
                return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
            });
        };
        if (v instanceof AddFriend) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                if (v.value0 instanceof Data_Either.Left) {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                };
                if (v.value0 instanceof Data_Either.Right) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v2) {
                        var $120 = {};
                        for (var $121 in v2) {
                            if ({}.hasOwnProperty.call(v2, $121)) {
                                $120[$121] = v2[$121];
                            };
                        };
                        $120.newFriend = new Data_Either.Left("");
                        return $120;
                    }))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(handleFIDCallEff(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Halogen_Query_HalogenM.monadAffHalogenM(Control_Monad_Aff_Class.monadAffAff))(v1.errorBus)(Data_Unit.unit)(Network_Eth_FriendInDebt.createFriendship(v.value0.value0)))(function () {
                            return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                        });
                    });
                };
                throw new Error("Failed pattern match at Debts line 130, column 7 - line 134, column 32: " + [ v.value0.constructor.name ]);
            });
        };
        if (v instanceof InputFriend) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)((function () {
                var $126 = Data_String.length(v.value0) === 42;
                if ($126) {
                    return Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v1) {
                        var $127 = {};
                        for (var $128 in v1) {
                            if ({}.hasOwnProperty.call(v1, $128)) {
                                $127[$128] = v1[$128];
                            };
                        };
                        $127.newFriend = Data_Either.Right.create(v.value0);
                        return $127;
                    });
                };
                return Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v1) {
                    var $130 = {};
                    for (var $131 in v1) {
                        if ({}.hasOwnProperty.call(v1, $131)) {
                            $130[$131] = v1[$131];
                        };
                    };
                    $130.newFriend = new Data_Either.Left(v.value0);
                    return $130;
                });
            })())(function () {
                return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
            });
        };
        if (v instanceof InputName) {
            return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v1) {
                var $135 = {};
                for (var $136 in v1) {
                    if ({}.hasOwnProperty.call(v1, $136)) {
                        $135[$136] = v1[$136];
                    };
                };
                $135.inputName = v.value0;
                return $135;
            }))(function () {
                return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
            });
        };
        if (v instanceof UpdateName) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(handleFIDCallEff(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Halogen_Query_HalogenM.monadAffHalogenM(Control_Monad_Aff_Class.monadAffAff))(v1.errorBus)(Data_Unit.unit)(Network_Eth_FriendInDebt.setCurrentUserName(v1.inputName)))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v2) {
                        var $141 = {};
                        for (var $142 in v2) {
                            if ({}.hasOwnProperty.call(v2, $142)) {
                                $141[$142] = v2[$142];
                            };
                        };
                        $141.inputName = "";
                        return $141;
                    }))(function () {
                        return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                    });
                });
            });
        };
        if (v instanceof CreateDebt) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.gets(Halogen_Query_HalogenM.monadStateHalogenM)(function (v1) {
                return v1.creating;
            }))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v2) {
                    var $147 = {};
                    for (var $148 in v2) {
                        if ({}.hasOwnProperty.call(v2, $148)) {
                            $147[$148] = v2[$148];
                        };
                    };
                    $147.creating = Data_Map.insert(Network_Eth_FriendInDebt.ordUserAddress)(Network_Eth_FriendInDebt.getFriendAddr(v.value0))(v.value0)(v1);
                    return $147;
                }))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                });
            });
        };
        if (v instanceof SendDebt) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                var v2 = Data_Map.lookup(Network_Eth_FriendInDebt.ordUserAddress)(v.value0)(v1.creating);
                if (v2 instanceof Data_Maybe.Nothing) {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                };
                if (v2 instanceof Data_Maybe.Just) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(handleFIDCallEff(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Halogen_Query_HalogenM.monadAffHalogenM(Control_Monad_Aff_Class.monadAffAff))(v1.errorBus)(Data_Unit.unit)(Network_Eth_FriendInDebt.newPending(v2.value0)))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v3) {
                            var $154 = {};
                            for (var $155 in v3) {
                                if ({}.hasOwnProperty.call(v3, $155)) {
                                    $154[$155] = v3[$155];
                                };
                            };
                            $154.creating = Data_Map["delete"](Network_Eth_FriendInDebt.ordUserAddress)(v.value0)(v1.creating);
                            return $154;
                        }))(function () {
                            return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                        });
                    });
                };
                throw new Error("Failed pattern match at Debts line 155, column 7 - line 159, column 33: " + [ v2.constructor.name ]);
            });
        };
        if (v instanceof ConfirmPending) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(handleFIDCallEff(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Halogen_Query_HalogenM.monadAffHalogenM(Control_Monad_Aff_Class.monadAffAff))(v1.errorBus)(Data_Unit.unit)(Network_Eth_FriendInDebt.confirmPending(v.value0)))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (v2) {
                        var $161 = {};
                        for (var $162 in v2) {
                            if ({}.hasOwnProperty.call(v2, $162)) {
                                $161[$162] = v2[$162];
                            };
                        };
                        $161.pending = Data_Semigroup.append(Data_Semigroup.semigroupArray)(Data_Array.filter(function (fd) {
                            return Data_Eq.notEq(Network_Eth_FriendInDebt.eqFriendDebt)(fd)(v.value0);
                        })(v1.pending))([ Network_Eth_FriendInDebt.setDebt(v.value0)(Data_Int.toNumber(0)) ]);
                        return $161;
                    }))(function () {
                        return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                    });
                });
            });
        };
        if (v instanceof CancelPending) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(handleFIDCallEff(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Halogen_Query_HalogenM.monadAffHalogenM(Control_Monad_Aff_Class.monadAffAff))(v1.errorBus)(Data_Unit.unit)(Network_Eth_FriendInDebt.cancelPending(v.value0.friend)))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                });
            });
        };
        if (v instanceof RefreshDebts) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.gets(Halogen_Query_HalogenM.monadStateHalogenM)(function (v1) {
                return v1.errorBus;
            }))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(loadFriendsAndDebts(Halogen_Query_HalogenM.bindHalogenM)(Halogen_Query_HalogenM.monadStateHalogenM)(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Halogen_Query_HalogenM.monadAffHalogenM(Control_Monad_Aff_Class.monadAffAff))(v1))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                });
            });
        };
        throw new Error("Failed pattern match at Debts line 124, column 10 - line 174, column 16: " + [ v.constructor.name ]);
    };
    return Halogen_Component.component(Halogen_HTML_Core.bifunctorHTML)({
        initialState: initialState, 
        render: render, 
        "eval": $$eval, 
        receiver: Halogen_HTML_Events.input(HandleInput.create)
    });
})();
module.exports = {
    RefreshDebts: RefreshDebts, 
    HandleInput: HandleInput, 
    CreateDebt: CreateDebt, 
    SendDebt: SendDebt, 
    ConfirmPending: ConfirmPending, 
    CancelPending: CancelPending, 
    AddFriend: AddFriend, 
    InputFriend: InputFriend, 
    InputName: InputName, 
    UpdateName: UpdateName, 
    addFriendWidget: addFriendWidget, 
    cancelButton: cancelButton, 
    component: component, 
    confirmButton: confirmButton, 
    createDebt: createDebt, 
    displayAllDebt: displayAllDebt, 
    displayAllDebtLi: displayAllDebtLi, 
    displayDebt: displayDebt, 
    displayDebtChanges: displayDebtChanges, 
    displayFriendDebtLi: displayFriendDebtLi, 
    displayFriendDebtSpan: displayFriendDebtSpan, 
    displayFriendLi: displayFriendLi, 
    displayPending: displayPending, 
    handleFIDCallAff: handleFIDCallAff, 
    handleFIDCallEff: handleFIDCallEff, 
    loadFriendsAndDebts: loadFriendsAndDebts, 
    mkDebt: mkDebt, 
    moneyClass: moneyClass, 
    moneySpan: moneySpan, 
    nameChangeWidget: nameChangeWidget, 
    nonZero: nonZero, 
    numberFromString: numberFromString, 
    refreshButton: refreshButton, 
    reverseMoneyClass: reverseMoneyClass
};
